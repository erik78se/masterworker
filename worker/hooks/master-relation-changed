#!/usr/bin/env python3
import os
import sys
sys.path.insert(0, os.path.join(os.environ['CHARM_DIR'], 'lib'))
import hookenv

def writeWorkerkeyFile(workerkey):
    """ Write the workerkey to file in the charm directory,
    indicating the service is related to the master """
    WorkerKeyFile = open("WORKERKEY.file", 'w')
    WorkerKeyFile.write(workerkey)
    WorkerKeyFile.close()


def master_relation_changed():

    if not hookenv.relation_get('worker-key'):

        hookenv.status_set("waiting", "worker-key not available on the relation.")

    else:

        hookenv.log(" ========= WORKER KEY AVAILABE  ========")

        workerKey = hookenv.relation_get('worker-key')

        # Do the work of setting up the service.
        writeWorkerkeyFile(workerKey)

        # Perhaps do some checks here to see that we are all good?

        hookenv.status_set("active", f"WorkerKey: {workerKey}")
    
if __name__ == "__main__":
    master_relation_changed()
