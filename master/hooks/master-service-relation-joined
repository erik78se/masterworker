#!/usr/bin/env python3
import os
import sys
sys.path.insert(0, os.path.join(os.environ['CHARM_DIR'], 'lib'))
import hookenv
import random

def generateWorkerKey():
    """Return a random key of length 4,
    which will be passed as new workers join."""
    return ''.join(random.choice('0123456789ABCDEF') for i in range(4))

def master_service_relation_joined():

    relation_id = hookenv.relation_id()

    hookenv.log(f"=========== JOINED new relation {relation_id} =============")

    _wk = generateWorkerKey()

    relation_data = { 'worker-key': _wk }
    # Pick this up in 'relation-changed' hook on the other side
    hookenv.relation_set(relation_id,
                         relation_settings=relation_data )

if __name__ == "__main__":
    master_service_relation_joined()